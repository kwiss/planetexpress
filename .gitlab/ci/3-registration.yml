################################################################################################
###################################                    #########################################
###################################     REGISTRATION   #########################################
###################################                    #########################################
################################################################################################

#
# docker image registration
# these base jobs can be reused to build and publish your docker images
#

.base_docker_image_stage:
  image: docker:19
  services:
    - docker:19-dind

.register_stage:
  stage: "registration"
  interruptible: true
  dependencies: []

Register app image:
  extends:
    - .base_register_stage
    - .register_stage
  dependencies:
    - Build @planetexpress/app
  needs:
    - Install app
    - Build @planetexpress/app
  before_script:
    - cp yarn.lock packages/app/yarn.lock
  variables:
    CONTEXT: packages/app
    IMAGE_NAME: $CI_REGISTRY_IMAGE/app